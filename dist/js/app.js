!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";function i(){return{Series:[]}}function a(){return"cloudBackup_Local"}function s(e){c(e,"abSeriesKeeperSettings",e.getLocalStorageType(),e.getEmptyObject())}function r(e,t){d("abSeriesKeeperSettings",JSON.stringify(e,null,2),t,e)}function o(e,t){let n="abSeriesKeeper",i=t.getStorageType();"cloudBackup_Local"==t.getStorageType()?n="abSeriesKeeper_ChromeCloudBackup":"chrome_sync"==t.getStorageType()&&1==t.getSyncCrash()&&(n="abSeriesKeeper_ChromeCloudBackup",i="cloudBackup_Local"),c(e,n,i,{Series:[]})}function l(e,t){let n="abSeriesKeeper",i=JSON.stringify(e,null,2);"chrome_sync"==t.getStorageType()?d("abSeriesKeeper_ChromeCloudBackup",i,"cloudBackup_Local"):"cloudBackup_Local"==t.getStorageType()&&(n="abSeriesKeeper_ChromeCloudBackup"),d(n,i,t.getStorageType(),t)}function d(e,t,n,i){switch(n){case"local":localStorage.setItem(e,t);break;case"chrome_local":chrome.storage.local.clear(),chrome.storage.local.set({[e]:t});break;case"chrome_sync":let n=function(e,t){const n=Math.ceil(e.length/t),i=new Array(n);for(let a=0,s=0;a<n;++a,s+=t)i[a]=e.substr(s,t);return i}(t,4e3);chrome.storage.sync.clear();const a=e=>new Promise((t,n)=>{chrome.storage.sync.set(e,()=>{chrome.runtime.lastError?n():t()})});Promise.all(n.map((t,n)=>a({[e+"_"+n]:t}))).then(()=>{0!=i.getSyncCrash()&&(i.setSyncCrash(!1),r(i.dataObject,i.getLocalStorageType()))}).catch(()=>{!function(e){let t="Chrome cloud operations quota exceeded, cloud data deleted! The list will be restored from a local backup.",n=console.log(t);0==e.getSyncCrash()&&(e.setSyncCrash(!0),r(e.dataObject,e.getLocalStorageType()));n=alert(t)}(i)});break;case"cloudBackup_Local":localStorage.setItem(e,t)}}function c(e,t,n,i={}){switch(n){case"local":u(e,localStorage.getItem(t),i);break;case"chrome_local":chrome.storage.local.get([t],n=>{u(e,n[t],i)});break;case"chrome_sync":chrome.storage.sync.get(n=>{let a="",s=Object.keys(n).length,r=0;for(;r<s;)a+=n[t+"_"+r],r++;u(e,a,i)});break;case"cloudBackup_Local":u(e,localStorage.getItem(t),i)}return JSON.parse(localStorage.getItem(t))}function u(e,t,n){let i;try{i=JSON.parse(t)}catch{i=n}e.dataObject=i}function g(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("settings.html"))}function m(e,t){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function h(e,t){m(t,JSON.stringify(e))}function p(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){let t=document.createElement("input");t.type="file",t.onchange=t=>{let n=t.target.files[0],i=new FileReader;i.readAsText(n,"UTF-8"),i.onload=t=>{let n=t.target.result;e.importList(n)}},t.click()}else alert("The File APIs are not fully supported in this browser.")}n.r(t),n.d(t,"getEmptyObjList",(function(){return i})),n.d(t,"getBackupStorageType",(function(){return a})),n.d(t,"loadAppSettings",(function(){return s})),n.d(t,"saveAppSettings",(function(){return r})),n.d(t,"loadObjectListFromStorage",(function(){return o})),n.d(t,"saveObjectList",(function(){return l})),n.d(t,"appSettingsOpen",(function(){return g})),n.d(t,"download",(function(){return m})),n.d(t,"exportObject",(function(){return h})),n.d(t,"fileSelectButtonClick",(function(){return p}))},function(e,t,n){"use strict";function i(e,t,n,i){let a=function(e,t,n){let i=n-t,a=100;0==!i&&(a=(e-t)/i*100);return a}(t,n,i),s=e[0],l=e[1],d=e[2];return o(r(a,s.start,s.end),r(a,l.start,l.end),r(a,d.start,d.end))}function a(e){return o(e[0].start,e[1].start,e[2].start)}function s(e){return o(e[0].end,e[1].end,e[2].end)}function r(e,t,n){return e*(n-t)/100+t}function o(e,t,n){let i=c(e/=240,t/=240,n/=240);return"#"+("000000"+(65536*i[0]+256*i[1]+1*i[2]).toString(16)).slice(-6)}function l(e){let t=d(e);return g(t[0],t[1],t[2])}function d(e){return e=e.replace("#",""),[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}function c(e,t,n){let i,a,s;if(0==t)i=a=s=n;else{let r=n<.5?n*(1+t):n+t-n*t,o=2*n-r;i=u(o,r,e+1/3),a=u(o,r,e),s=u(o,r,e-1/3)}return[Math.round(255*i),Math.round(255*a),Math.round(255*s)]}function u(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function g(e,t,n){e/=255,t/=255,n/=255;let i,a,s=Math.max(e,t,n),r=Math.min(e,t,n),o=(s+r)/2;if(s==r)i=a=0;else{let l=s-r;switch(a=o>.5?l/(2-s-r):l/(s+r),s){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return i=Math.round(240*i),a=Math.round(240*a),o=Math.round(240*o),[i,a,o]}n.r(t),n.d(t,"getColorByHSLRange",(function(){return i})),n.d(t,"getStartColorFromParam",(function(){return a})),n.d(t,"getEndColorFromParam",(function(){return s})),n.d(t,"hslToHEX",(function(){return o})),n.d(t,"hexToHSL",(function(){return l})),n.d(t,"hexToRGB",(function(){return d})),n.d(t,"hslToRgb",(function(){return c})),n.d(t,"hue2rgb",(function(){return u})),n.d(t,"rgbToHsl",(function(){return g}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));class i{constructor(e=this.getEmptyObject()){this._dataProvider,this._updateListeners=[],this.dataObject=e}get dataObject(){return this._dataObject}set dataObject(e){this._dataObject||(this._dataObject=this.getEmptyObject()),this.setObjSettings(e),this.callListenersFunctions()}get dataProvider(){return this._dataProvider}set dataProvider(e){this._dataProvider=e}addUpdateListenersFunctions(...e){this._updateListeners=this._updateListeners.concat(e)}callListenersFunctions(){this._updateListeners.forEach(e=>e())}getEmptyObject(){return{}}setObjSettings(e){if(e)for(const[t,n]of Object.entries(e))e.hasOwnProperty(t)?this._dataObject[t]=n:this.setObjValueByKey(t)}setObjValueByKey(e){switch(e){case"StorageType":objData.StorageType=this.getStorageType();break;case"ScrollToActive":objData.ScrollToActive=this.getScrollToActive();break;case"AgeingColorScheme":objData.AgeingColorScheme=this.getAgeingColorScheme();break;case 0!==objData.AgeingPeriod:objData.AgeingPeriod=this.getAgeingPeriod()}}getStorageType(){let e=this.getLocalStorageType();return this.getObjSettingsByName("StorageType",e)}getLocalStorageType(){return"local"}setStorageType(e){this.dataObject.StorageType=e}isCurrentStorageClosed(){return this.getStorageType()===this.dataProvider.getBackupStorageType()}getSyncCrash(){return this.getObjSettingsByName("SyncCrash",!1)}setSyncCrash(e){1==e?this.dataObject.SyncCrash=e:this.dataObject.hasOwnProperty("SyncCrash")&&(delete this.dataObject.SyncCrash,this.callListenersFunctions())}getScrollToActive(){return this.getObjSettingsByName("ScrollToActive",!0)}setScrollToActive(e){this.dataObject.ScrollToActive=e}getAgeingColorScheme(){return this.getObjSettingsByName("AgeingColorScheme",[{start:60,end:40},{start:215,end:240},{start:122,end:230}])}setAgeingColorScheme(e){this.dataObject.AgeingColorScheme=e}getAgeingPeriod(){return this.getObjSettingsByName("AgeingPeriod",0)}setAgeingPeriod(e){this.dataObject.AgeingPeriod=e}getObjSettingsByName(e,t){let n,i=this.dataObject;return n=i&&i.hasOwnProperty(e)?i[e]:t,n}}},,function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"getTableListStructure",(function(){return r})),n.d(i,"getSeasonObjName",(function(){return o})),n.d(i,"getEpisodeObjName",(function(){return l})),n.d(i,"getLinksObjName",(function(){return d})),n.d(i,"getSeasonTemplate",(function(){return c})),n.d(i,"getEpisodeTemplate",(function(){return u})),n.d(i,"getTableHeadTags",(function(){return g})),n.d(i,"getSettingsLineElement",(function(){return m})),n.d(i,"getSettingsStringClassName",(function(){return h})),n.d(i,"getLineButtonsSectionTags",(function(){return p})),n.d(i,"switchButtonsToEdit",(function(){return b})),n.d(i,"switchButtonsToSaved",(function(){return y})),n.d(i,"getListLineTags",(function(){return S})),n.d(i,"getFilledElementByObjectLine",(function(){return f})),n.d(i,"getEmptyEditElement",(function(){return L})),n.d(i,"getInputFieldLineTag",(function(){return N})),n.d(i,"getTextFieldLineTag",(function(){return _})),n.d(i,"lnkStringByData",(function(){return j})),n.d(i,"ShowSyncSaveCrashWarning",(function(){return T}));var a=n(1),s=n(0);function r(){return[{domName:"series",domHeader:"Series",domClassaName:"tSeriesName",fieldType:"text",objName:"name"},{domName:"",domHeader:"",domClassaName:"",fieldType:"lnk",objName:"links"},{domName:"season",domHeader:"Season",domClassaName:"tSeasons",fieldType:"number",objName:"season"},{domName:"epWatched",domHeader:"Watched",domClassaName:"tEpisodes",fieldType:"number",objName:"episode"},{domName:"",domHeader:"",domClassaName:"",fieldType:"text",objName:""},{domName:"",domHeader:"",domClassaName:"",fieldType:"date",objName:"lastCounterChangeTime"}]}function o(){return"season"}function l(){return"episode"}function d(){return"links"}function c(){return"{season}"}function u(){return"{episode}"}function g(e){let t="<tr>";return e.filter(e=>e.domName).forEach(e=>{t+="<th>"+e.domHeader+"</th>"}),t+="<th></th></tr>",t}function m(e,t){let n="<td id='settings_tmp_row"+e+"' class = 'SettingsZeroPadding' colspan = '3'>";n+=t,n+="</td>";let i=document.createElement("tr");return i.id="options_temp_row"+e,i.className="table_line_settings",i.innerHTML=n,i}function h(){return"table_line_settings"}function p(e,t=!0,n=!1){let i="inline",a="inline";!0===t?i="none":a="none";let s="";return s=!0===n?"<td class='tableBtn'></td>":"<td class='tableBtn'>"+("<input type='button' id='edit_button"+e+"' value='' class='editBtn' style='display: "+i+";'>")+" "+("<input type='button' id='save_button"+e+"' value='' class='saveBtn' style='display: "+a+";'>")+" "+("<input type='button' id='del_button"+e+"' value='' class='trashBtn' style='display: inline;'></td>")+"</td>",s}function b(e){document.getElementById("edit_button"+e).style.display="none",document.getElementById("save_button"+e).style.display="inline"}function y(e){document.getElementById("edit_button"+e).style.display="inline",document.getElementById("save_button"+e).style.display="none"}function S(e,t,n=null,i=!1){let a="";return t.tableStructure.filter(e=>e.domName).forEach((s,r,o)=>{let l=t.getClassName(s.domName),d=t.getfieldType(s.domName);if(n){let r=t.getJsonAttrName(s.domName);a+=this.getFilledElementByObjectLine(s.domName,e,r,n,l,i)}else a+=this.getEmptyEditElement(s.domName,e,l,d)}),a+=this.getLineButtonsSectionTags(e,!n,i),a}function f(e,t,n,i,a,s=!1){let r="";if(i&&i.hasOwnProperty(n)&&(r=i[n]),"series"==e&&i.links&&i.links.length>0){r="<span style='vertical-align: middle'>"+r+"</span>",r+="<div class='dropdown'><input type='button' class = 'lnkSelector'><div id='"+("row"+t+"_ddLnk")+"' class='dropdown-content'></div></div>"}else"season"!=e&&"epWatched"!=e||(r=!0===s?"<div class='counterContainer'> <div class='counterValue'>"+r+"</div></div>":"<div class='counterContainer'> <input type='button' class = 'downBtn'><div class='counterValue'>"+r+"</div><input type='button' class = 'upBtn'></div>");return this.getTextFieldLineTag(e,t,a,r)}function L(e,t,n,i="text"){let a=N(e,t,i);return this.getTextFieldLineTag(e,t,n,a)}function N(e,t,n="text",i=""){let a="";return"number"===n&&(a=" min='0'"),"<input type='"+n+"' id='"+e+"_text"+t+"'"+a+" class='TableInput' value='"+i+"'>"}function _(e,t,n,i=""){return n&&(n="class='"+n+"'"),"<td id='"+e+"_row"+t+"' "+n+">"+i+"</td>"}function j(e,t=e){return"<a href="+e+" target='_blank'>"+t+"</a>"}function T(e){let t="syncWarning";if(!document.getElementById(t)&&e){let e=document.getElementsByClassName("tableWrapper")[0],n=document.createElement("label");n.id=t,n.className="warningMessage",n.innerHTML="This is a list restored from a local backup. An attempt to save the list to the cloud settings will be made after any change!",e.insertAdjacentElement("afterbegin",n)}else if(!e){let e=document.getElementById(t);e&&e.remove()}}class w{constructor(e,t=[],n=""){this._listName=e,this._dataArray=t,this._pageLink=n}get listName(){return this._listName}get pageLink(){return this._pageLink}get dataArray(){return this._dataArray}set dataArray(e){this._dataArray=e}buttonClick(e,t){-1!==e.id.indexOf("_btnNew")?this.addLine():-1!==e.id.indexOf("_delBtn")&&this.delLine(t[1])}enterKeyDown(e,t){-1!==e.id.indexOf("_inpNew")&&this.addLine()}exportDataList(){let e=document.getElementById(this.listName+"_ul").getElementsByTagName("LI");this.dataArray=[];for(var t=0;t<e.length-2;t++){let e=document.getElementById(this.listName+"_inp"+t).value;this.dataArray.push(e)}return this.dataArray}clearList(){this.dataArray=[],this.updateListBody()}delLine(e,t=!0){this.dataArray.splice(e,1),!0===t&&this.updateListBody()}addLine(e=!0){let t=document.getElementById(this.listName+"_inpNew");t.value||(t.value=this.pageLink),this.dataArray.push(t.value),e&&(t.value="",this.addLastLineDom())}addLastLineDom(){let e=this.dataArray.length-1,t=document.createElement("li");t.id=this.listName+"_li"+e,t.className="item",t.innerHTML=this.getLiContentLine(e);let n=document.getElementById(this.listName+"_ul"),i=n.getElementsByTagName("LI").length;n.insertBefore(t,n.childNodes[i-1])}updateListBody(){document.getElementById(this.listName+"_ul").outerHTML=this.getListBody()}getListBody(){let e=this.listName+"_ul",t="";return t+="<ul id='"+e+"' class='editable-list'>",t+="<li class='listHeader'><h3>Links:</h3></li>",this.dataArray.forEach((e,n)=>{let i=this.listName+"_li"+n;t+="<li id='"+i+"' class='item'>"+this.getLiContentLine(n)+"</li>"}),t+="<li class='item'>"+this.getLiContentLine()+"</li>",t+="</ul>",t}getLiContentLine(e=-1){let t="";if(e<0||e>this.dataArray.length){t="<input id='"+(this.listName+"_inpNew")+"' class = 'ListInput' type='text' placeholder='"+'Enter new link and press "Enter" or "+" button to add'+"' value=''><span id='"+(this.listName+"_btnNew")+"' class='settingsListButton'>+</span>"}else{let n=this.listName+"_inp"+e,i=this.listName+"_delBtn"+e;t="<input id='"+n+"' class = 'ListInput' type='text' value='"+this.dataArray[e]+"'><span id='"+i+"' class='settingsListButton'>&times;</span>"}return t}}var O=n(2);let v=new class{constructor(e,t={},n=[{domName:"",domHeader:"",fieldType:"",objName:""}]){this._tName=e,this._dataObject=t,this._tableStructure=n,this._designModule,this._dataProvider,this._appSettings,this._colorConverter,this._EditableListClass,this._editableListInUse={},this._activeLink}get tableName(){return this._tName}get dataObject(){return this._dataObject}set dataObject(e){this.fillTableFromObj(e)&&(this._dataObject=e)}get tableStructure(){return this._tableStructure}set tableStructure(e){this._tableStructure=e}get designModule(){return this._designModule}set designModule(e){this._designModule=e}get dataProvider(){return this._dataProvider}set dataProvider(e){this._dataProvider=e}get appSettings(){return this._appSettings}set appSettings(e){this._appSettings=e;this._appSettings.addUpdateListenersFunctions(()=>{this.refreshDom()})}get colorConverter(){return this._colorConverter}set colorConverter(e){this._colorConverter=e}get EditableListClass(){return this._EditableListClass}set EditableListClass(e){this._EditableListClass=e}get editableListInUse(){return this._editableListInUse}set editableListInUse(e){this._editableListInUse=e}get activeLink(){return this._activeLink}set activeLink(e){this._activeLink=e}setEventHandlerForSettings(){let e=document.getElementById(this.tableName).getElementsByTagName("tbody")[0];e.addEventListener("click",e=>{switch(!0){case"settingsListButton"===e.target.className:let t=e.target.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.editableListInUse["lnkRow"+t[0]].buttonClick(e.target,t);break;case"lnkSelector"===e.target.className:this.closeAllDropDowns();let n=e.target.parentNode.parentNode.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.showDropDownList(n[0]);break;case"downBtn"===e.target.className||"upBtn"===e.target.className:this.counterChange(e.target.className,e.target.parentNode.parentNode.id)}},!1),e.addEventListener("keydown",e=>{switch(!0){case 13===e.keyCode&&"ListInput"===e.target.className:let t=e.target.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.editableListInUse["lnkRow"+t[0]].enterKeyDown(e.target,t)}},!1),window.onclick=e=>{e.target.matches(".lnkSelector")||this.closeAllDropDowns()}}showDropDownList(e){let t="row"+e+"_ddLnk",n=document.getElementById(t),i="",a=this.dataObject;if(a&&a.Series&&e<a.Series.length){let t=this.designModule.getLinksObjName(),n=this.dataObject.Series[e][t];n&&n.forEach(t=>{let n=t.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),a=n&&n[1];a||(a=t);let s=this.applyLnkTemplate(t,this.dataObject.Series[e]);i+=this.designModule.lnkStringByData(s,a)})}n.classList.toggle("show"),n.innerHTML=i}closeAllDropDowns(){let e=document.getElementsByClassName("dropdown-content");for(let t=0;t<e.length;t++){e[t].innerHTML="";let n=e[t];n.classList.contains("show")&&n.classList.remove("show")}}counterChange(e,t){let n=t.match(/^\d+|\d+\b|\d+(?=\w)/g),i=String(t.match(/[^_]*/)).toString(),a=this.getJsonAttrName(i),s=0;"upBtn"===e?s=1:"downBtn"===e&&(s=-1);let r=this.dataObject.Series[n];if(r[a]+=s,a===this.designModule.getSeasonObjName()&&s>0){r[this.designModule.getEpisodeObjName()]=0}this.updateLineCounterChangeDate(n),this.callObjListSave(this.dataObject),document.getElementById("row"+n).innerHTML=this.designModule.getListLineTags(n,this,r,this.appSettings.isCurrentStorageClosed()),this.setColorByLineDateChange(n,r),this.setRowStyleByActiveTabLink(n,r)}updateLineCounterChangeDate(e){let t=this.dataObject.Series[e],n=new Date;t.lastCounterChangeTime=n.getTime()}getJsonAttrName(e){return this._tableStructure.filter(t=>t.domName===e)[0].objName}getClassName(e){return this._tableStructure.filter(t=>t.domName===e)[0].domClassaName}getfieldType(e){return this._tableStructure.filter(t=>t.domName===e)[0].fieldType}getObjectLineAttributesAsObject(){return this._tableStructure.reduce((e,t)=>(t.objName&&Object.assign(e,{[t.objName]:""}),e),{})}getObjectLineAttributes(){return Object.keys(this.getObjectLineAttributesAsObject())}refreshDom(){this.fillTableFromObj(this.dataObject)}fillTableFromObj(e){this.designModule.ShowSyncSaveCrashWarning(this.appSettings.getSyncCrash());let t=!1;return e&&e.hasOwnProperty("Series")&&(this.clearTableRows(),e.Series.forEach(e=>{this.addRow(e)}),t=!0),this.addEditRowIfEmpty(),t}addEditRowIfEmpty(){document.getElementById(this._tName).getElementsByTagName("tbody")[0].rows.length<1&&this.addRow()}importList(e){try{let t=JSON.parse(e);this.dataObject=t,this.callObjListSave(this.dataObject)}catch(e){console.error(e.name+": "+e.message),alert("Wrong file format. Please select correct json file.")}}updateHeader(){document.getElementById(this._tName).getElementsByTagName("thead")[0].innerHTML=this.designModule.getTableHeadTags(this.tableStructure)}clearTableRows(){this.updateHeader(),document.getElementById(this._tName).getElementsByTagName("tbody")[0].innerHTML="",this.editableListInUse={}}addRow(e=null){let t=document.getElementById(this._tName).getElementsByTagName("tbody")[0],n=document.getElementsByClassName(this.designModule.getSettingsStringClassName()),i=t.rows.length,a=i-n.length,s=this.dataObject;if(!e&&s.Series&&a-s.Series.length>0)return;let r="<tr id='row"+a+"'>";r+=this.designModule.getListLineTags(a,this,e,this.appSettings.isCurrentStorageClosed()),r+="</tr>",t.insertRow(i).outerHTML=r,e||this.addSettingsRow(a),this.setColorByLineDateChange(a,e),this.setRowStyleByActiveTabLink(a,e)}edit_row(e){this._tableStructure.filter(e=>e.domName).forEach((t,n,i)=>{let a="",s=this.dataObject;if(s&&s.Series&&e<s.Series.length){let n=this.getJsonAttrName(t.domName);a=this.dataObject.Series[e][n]}let r=document.getElementById(t.domName+"_row"+e),o=this.getfieldType(t.domName);r.innerHTML=this.designModule.getInputFieldLineTag(t.domName,e,o,a)}),this.addSettingsRow(e),this.designModule.switchButtonsToEdit(e)}save_row(e){let t=this.dataObject,n=t.Series;if(e-n.length>0)return void alert("Please save the lines in order it added!");e>=n.length&&n.push(this.getObjectLineAttributesAsObject());let i=n[e];this.tableStructure.forEach((t,n,a)=>{let s=this.getfieldType(t.domName);if("lnk"==s){let n=this.editableListInUse["lnkRow"+e];i[this.getJsonAttrName(t.domName)]=n.exportDataList()}else if(this.getJsonAttrName(t.domName)){let n=document.getElementById(t.domName+"_text"+e).value;"number"==s&&(n=parseInt(n),n||(n=0)),i[this.getJsonAttrName(t.domName)]=n}}),this.delSettingsRow(e),document.getElementById("row"+e).innerHTML=this.designModule.getListLineTags(e,this,i,this.appSettings.isCurrentStorageClosed()),this.callObjListSave(t),this.setColorByLineDateChange(e,i),this.setRowStyleByActiveTabLink(e,i)}delete_row(e){let t=this.dataObject;t.Series.length>0&&(t.Series.splice(e,1),this.callObjListSave(t)),this.fillTableFromObj(t)}callObjListSave(e){this.dataProvider.saveObjectList(e,this.appSettings),this.designModule.ShowSyncSaveCrashWarning(this.appSettings.getSyncCrash())}addSettingsRow(e){let t=document.getElementById("row"+e),n=this.getSettingsLineBody(e),i=this.designModule.getSettingsLineElement(e,n);t.parentNode.insertBefore(i,t.nextSibling)}delSettingsRow(e){document.getElementById("options_temp_row"+e).outerHTML="",delete this.editableListInUse["lnkRow"+e]}getActiveLink(){chrome.tabs.query({active:!0,lastFocusedWindow:!0},e=>{let t=e[0].url;this.activeLink=t.split(/[?#]/)[0],this.checkLinesByLnk()})}getSettingsLineBody(e){let t=[],n=this.dataObject;if(n&&n.Series&&e<n.Series.length){let n=this.designModule.getLinksObjName();t=this.dataObject.Series[e][n]}let i=new this.EditableListClass("lnkSettings_row"+e,t,this.activeLink),a=i.getListBody();return this.editableListInUse["lnkRow"+e]=i,a}setColorByLineDateChange(e,t){if(t&&t.hasOwnProperty("lastCounterChangeTime")){let n=new Date,i=864e5,a=Math.trunc((n.getTime()-t.lastCounterChangeTime)/i),s=this.appSettings.getAgeingPeriod();if(a>=0&&a<s){let t=this.appSettings.getAgeingColorScheme();document.getElementById("row"+e).style.backgroundColor=this.colorConverter.getColorByHSLRange(t,a,0,s)}}}checkLinesByLnk(){let e=this.dataObject;e&&e.Series&&e.Series.forEach((e,t)=>{this.setRowStyleByActiveTabLink(t,e)})}setRowStyleByActiveTabLink(e,t){if(this.isActiveTabInLinks(t)){let t=this._tableStructure[0].domName+"_row"+e;try{let e=document.getElementById(t);e.style["font-weight"]="bold",e.style["font-size"]="110%",this.appSettings.getScrollToActive()&&e.scrollIntoViewIfNeeded(!0)}catch{}}}isActiveTabInLinks(e){let t=!1,n=this.designModule.getLinksObjName();if(e&&e.hasOwnProperty(n)&&e[n].length>0){e[n].find(t=>this.applyLnkTemplate(t.split(/[?#]/)[0],e)===this.activeLink)&&(t=!0)}return t}applyLnkTemplate(e,t){let n=this.designModule.getSeasonObjName(),i=this.designModule.getEpisodeObjName(),a=this.designModule.getSeasonTemplate(),s=this.designModule.getEpisodeTemplate(),r=0,o=0;t[n]&&(r=t[n]),t[i]&&(o=t[i]);let l=e.replace(a,r.toString());return l=l.replace(s,o.toString()),l}}("slist_table",s.getEmptyObjList()),C=new O.a;C.dataProvider=s,s.loadAppSettings(C),v.appSettings=C,v.designModule=i,v.dataProvider=s,v.colorConverter=a,v.EditableListClass=w,v.tableStructure=[{domName:"series",domHeader:"Series",domClassaName:"tSeriesName",fieldType:"text",objName:"name"},{domName:"",domHeader:"",domClassaName:"",fieldType:"lnk",objName:"links"},{domName:"season",domHeader:"Season",domClassaName:"tSeasons",fieldType:"number",objName:"season"},{domName:"epWatched",domHeader:"Watched",domClassaName:"tEpisodes",fieldType:"number",objName:"episode"},{domName:"",domHeader:"",domClassaName:"",fieldType:"text",objName:""},{domName:"",domHeader:"",domClassaName:"",fieldType:"date",objName:"lastCounterChangeTime"}],v.fillTableFromObj(s.getEmptyObjList()),s.loadObjectListFromStorage(v,v.appSettings),v.setEventHandlerForSettings(),v.getActiveLink(),document.getElementById("settings-btn").addEventListener("click",()=>{s.appSettingsOpen()},!1),document.getElementById("imp-btn").addEventListener("click",()=>{v.addRow()},!1),document.getElementById("dwn-btn").addEventListener("click",()=>{s.exportObject(v.dataObject,"SerialList.json")},!1),document.getElementById("fileSelect-btn").addEventListener("click",()=>{s.fileSelectButtonClick(v)},!1),document.getElementById(v.tableName).getElementsByTagName("tbody")[0].addEventListener("click",e=>{switch(!0){case e.target.id.startsWith("edit_button"):v.edit_row(e.target.id.match(/\d/g).join(""));break;case e.target.id.startsWith("save_button"):v.save_row(e.target.id.match(/\d/g).join(""));break;case e.target.id.startsWith("del_button"):v.delete_row(e.target.id.match(/\d/g).join(""))}},!1)}]);