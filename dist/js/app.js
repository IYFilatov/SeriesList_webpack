!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=4)}([function(e,t,s){"use strict";function i(){return{Series:[]}}function n(){return"cloudBackup_Local"}function a(e){c(e,"abSeriesKeeperSettings",e.getLocalStorageType(),e.getEmptyObject())}function r(e,t){d("abSeriesKeeperSettings",JSON.stringify(e,null,2),t,e)}function o(e,t){let s="abSeriesKeeper",i=t.getStorageType();"cloudBackup_Local"==t.getStorageType()?s="abSeriesKeeper_ChromeCloudBackup":"chrome_sync"==t.getStorageType()&&1==t.getSyncCrash()&&(s="abSeriesKeeper_ChromeCloudBackup",i="cloudBackup_Local"),c(e,s,i,{Series:[]})}function l(e,t){let s="abSeriesKeeper",i=JSON.stringify(e,null,2);"chrome_sync"==t.getStorageType()?d("abSeriesKeeper_ChromeCloudBackup",i,"cloudBackup_Local"):"cloudBackup_Local"==t.getStorageType()&&(s="abSeriesKeeper_ChromeCloudBackup"),d(s,i,t.getStorageType(),t)}function d(e,t,s,i){switch(s){case"local":localStorage.setItem(e,t);break;case"chrome_local":chrome.storage.local.clear(),chrome.storage.local.set({[e]:t});break;case"chrome_sync":let s=function(e,t){const s=Math.ceil(e.length/t),i=new Array(s);for(let n=0,a=0;n<s;++n,a+=t)i[n]=e.substr(a,t);return i}(t,4e3);chrome.storage.sync.clear();const n=e=>new Promise((t,s)=>{chrome.storage.sync.set(e,()=>{chrome.runtime.lastError?s():t()})});Promise.all(s.map((t,s)=>n({[e+"_"+s]:t}))).then(()=>{0!=i.getSyncCrash()&&(i.setSyncCrash(!1),r(i.dataObject,i.getLocalStorageType()))}).catch(()=>{!function(e){let t="Chrome cloud operations quota exceeded, cloud data deleted! The list will be restored from a local backup.",s=console.log(t);0==e.getSyncCrash()&&(e.setSyncCrash(!0),r(e.dataObject,e.getLocalStorageType()));s=alert(t)}(i)});break;case"cloudBackup_Local":localStorage.setItem(e,t)}}function c(e,t,s,i={}){switch(s){case"local":u(e,localStorage.getItem(t),i);break;case"chrome_local":chrome.storage.local.get([t],s=>{u(e,s[t],i)});break;case"chrome_sync":chrome.storage.sync.get(s=>{let n="",a=Object.keys(s).length,r=0;for(;r<a;)n+=s[t+"_"+r],r++;u(e,n,i)});break;case"cloudBackup_Local":u(e,localStorage.getItem(t),i)}return JSON.parse(localStorage.getItem(t))}function u(e,t,s){let i;try{i=JSON.parse(t)}catch{i=s}e.dataObject=i}function g(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("settings.html"))}function h(e,t){let s=document.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),s.setAttribute("download",e),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}function m(e,t){h(t,JSON.stringify(e))}function p(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){let t=document.createElement("input");t.type="file",t.onchange=t=>{let s=t.target.files[0],i=new FileReader;i.readAsText(s,"UTF-8"),i.onload=t=>{let s=t.target.result;e.importList(s)}},t.click()}else alert("The File APIs are not fully supported in this browser.")}s.r(t),s.d(t,"getEmptyObjList",(function(){return i})),s.d(t,"getBackupStorageType",(function(){return n})),s.d(t,"loadAppSettings",(function(){return a})),s.d(t,"saveAppSettings",(function(){return r})),s.d(t,"loadObjectListFromStorage",(function(){return o})),s.d(t,"saveObjectList",(function(){return l})),s.d(t,"appSettingsOpen",(function(){return g})),s.d(t,"download",(function(){return h})),s.d(t,"exportObject",(function(){return m})),s.d(t,"fileSelectButtonClick",(function(){return p}))},function(e,t,s){"use strict";function i(e,t,s,i){let n=function(e,t,s){let i=s-t,n=100;0==!i&&(n=(e-t)/i*100);return n}(t,s,i),a=e[0],l=e[1],d=e[2];return o(r(n,a.start,a.end),r(n,l.start,l.end),r(n,d.start,d.end))}function n(e){return o(e[0].start,e[1].start,e[2].start)}function a(e){return o(e[0].end,e[1].end,e[2].end)}function r(e,t,s){return e*(s-t)/100+t}function o(e,t,s){let i=c(e/=240,t/=240,s/=240);return"#"+("000000"+(65536*i[0]+256*i[1]+1*i[2]).toString(16)).slice(-6)}function l(e){let t=d(e);return g(t[0],t[1],t[2])}function d(e){return e=e.replace("#",""),[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}function c(e,t,s){let i,n,a;if(0==t)i=n=a=s;else{let r=s<.5?s*(1+t):s+t-s*t,o=2*s-r;i=u(o,r,e+1/3),n=u(o,r,e),a=u(o,r,e-1/3)}return[Math.round(255*i),Math.round(255*n),Math.round(255*a)]}function u(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e}function g(e,t,s){e/=255,t/=255,s/=255;let i,n,a=Math.max(e,t,s),r=Math.min(e,t,s),o=(a+r)/2;if(a==r)i=n=0;else{let l=a-r;switch(n=o>.5?l/(2-a-r):l/(a+r),a){case e:i=(t-s)/l+(t<s?6:0);break;case t:i=(s-e)/l+2;break;case s:i=(e-t)/l+4}i/=6}return i=Math.round(240*i),n=Math.round(240*n),o=Math.round(240*o),[i,n,o]}s.r(t),s.d(t,"getColorByHSLRange",(function(){return i})),s.d(t,"getStartColorFromParam",(function(){return n})),s.d(t,"getEndColorFromParam",(function(){return a})),s.d(t,"hslToHEX",(function(){return o})),s.d(t,"hexToHSL",(function(){return l})),s.d(t,"hexToRGB",(function(){return d})),s.d(t,"hslToRgb",(function(){return c})),s.d(t,"hue2rgb",(function(){return u})),s.d(t,"rgbToHsl",(function(){return g}))},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e=this.getEmptyObject()){this._dataProvider,this._updateListeners=[],this.dataObject=e}get dataObject(){return this._dataObject}set dataObject(e){this._dataObject||(this._dataObject=this.getEmptyObject()),this.setObjSettings(e),this.callListenersFunctions()}get dataProvider(){return this._dataProvider}set dataProvider(e){this._dataProvider=e}addUpdateListenersFunctions(...e){this._updateListeners=this._updateListeners.concat(e)}callListenersFunctions(){this._updateListeners.forEach(e=>e())}getEmptyObject(){return{}}setObjSettings(e){if(e)for(const[t,s]of Object.entries(e))e.hasOwnProperty(t)?this._dataObject[t]=s:this.setObjValueByKey(t)}setObjValueByKey(e){switch(e){case"StorageType":objData.StorageType=this.getStorageType();break;case"ScrollToActive":objData.ScrollToActive=this.getScrollToActive();break;case"AgeingColorScheme":objData.AgeingColorScheme=this.getAgeingColorScheme();break;case 0!==objData.AgeingPeriod:objData.AgeingPeriod=this.getAgeingPeriod()}}getStorageType(){let e=this.getLocalStorageType();return this.getObjSettingsByName("StorageType",e)}getLocalStorageType(){return"local"}setStorageType(e){this.dataObject.StorageType=e}isCurrentStorageClosed(){return this.getStorageType()===this.dataProvider.getBackupStorageType()}getSyncCrash(){return this.getObjSettingsByName("SyncCrash",!1)}setSyncCrash(e){1==e?this.dataObject.SyncCrash=e:this.dataObject.hasOwnProperty("SyncCrash")&&(delete this.dataObject.SyncCrash,this.callListenersFunctions())}getScrollToActive(){return this.getObjSettingsByName("ScrollToActive",!0)}setScrollToActive(e){this.dataObject.ScrollToActive=e}getAgeingColorScheme(){return this.getObjSettingsByName("AgeingColorScheme",[{start:60,end:40},{start:215,end:240},{start:122,end:230}])}setAgeingColorScheme(e){this.dataObject.AgeingColorScheme=e}getAgeingPeriod(){return this.getObjSettingsByName("AgeingPeriod",0)}setAgeingPeriod(e){this.dataObject.AgeingPeriod=e}getObjSettingsByName(e,t){let s,i=this.dataObject;return s=i&&i.hasOwnProperty(e)?i[e]:t,s}}},,function(e,t,s){"use strict";s.r(t);var i={};s.r(i),s.d(i,"getTableListStructure",(function(){return r})),s.d(i,"getSeasonObjName",(function(){return o})),s.d(i,"getEpisodeObjName",(function(){return l})),s.d(i,"getLinksObjName",(function(){return d})),s.d(i,"getSeasonTemplate",(function(){return c})),s.d(i,"getEpisodeTemplate",(function(){return u})),s.d(i,"getTableHeadTags",(function(){return g})),s.d(i,"getSettingsLineElement",(function(){return h})),s.d(i,"getSettingsStringClassName",(function(){return m})),s.d(i,"getLineButtonsSectionTags",(function(){return p})),s.d(i,"switchButtonsToEdit",(function(){return b})),s.d(i,"switchButtonsToSaved",(function(){return y})),s.d(i,"getListLineTags",(function(){return S})),s.d(i,"getFilledElementByObjectLine",(function(){return L})),s.d(i,"getEmptyEditElement",(function(){return f})),s.d(i,"getInputFieldLineTag",(function(){return N})),s.d(i,"getTextFieldLineTag",(function(){return _})),s.d(i,"lnkStringByData",(function(){return T})),s.d(i,"ShowSyncSaveCrashWarning",(function(){return w}));var n=s(1),a=s(0);function r(){return[{domName:"series",domHeader:"Series",domClassaName:"tSeriesName",fieldType:"text",objName:"name"},{domName:"",domHeader:"",domClassaName:"",fieldType:"lnk",objName:"links"},{domName:"season",domHeader:"Season",domClassaName:"tSeasons",fieldType:"number",objName:"season"},{domName:"epWatched",domHeader:"Watched",domClassaName:"tEpisodes",fieldType:"number",objName:"episode"},{domName:"",domHeader:"",domClassaName:"",fieldType:"text",objName:""},{domName:"",domHeader:"",domClassaName:"",fieldType:"date",objName:"lastCounterChangeTime"}]}function o(){return"season"}function l(){return"episode"}function d(){return"links"}function c(){return"{season}"}function u(){return"{episode}"}function g(e){let t="<tr>";return e.filter(e=>e.domName).forEach(e=>{t+="<th>"+e.domHeader+"</th>"}),t+="<th></th></tr>",t}function h(e,t){let s="<td id='settings_tmp_row"+e+"' class = 'SettingsZeroPadding' colspan = '3'>";s+=t,s+="</td>";let i=document.createElement("tr");return i.id="options_temp_row"+e,i.className="table_line_settings",i.innerHTML=s,i}function m(){return"table_line_settings"}function p(e,t=!0,s=!1){let i="inline",n="inline";!0===t?i="none":n="none";let a="";return a=!0===s?"<td class='tableBtn'></td>":"<td class='tableBtn'>"+("<input type='button' id='edit_button"+e+"' value='' class='editBtn' style='display: "+i+";'>")+" "+("<input type='button' id='save_button"+e+"' value='' class='saveBtn' style='display: "+n+";'>")+" "+("<input type='button' id='del_button"+e+"' value='' class='trashBtn' style='display: inline;'></td>")+"</td>",a}function b(e){document.getElementById("edit_button"+e).style.display="none",document.getElementById("save_button"+e).style.display="inline"}function y(e){document.getElementById("edit_button"+e).style.display="inline",document.getElementById("save_button"+e).style.display="none"}function S(e,t,s=null,i=!1){let n="";return t.tableStructure.filter(e=>e.domName).forEach((a,r,o)=>{let l=t.getClassName(a.domName),d=t.getfieldType(a.domName);if(s){let r=t.getJsonAttrName(a.domName);n+=this.getFilledElementByObjectLine(a.domName,e,r,s,l,i)}else n+=this.getEmptyEditElement(a.domName,e,l,d)}),n+=this.getLineButtonsSectionTags(e,!s,i),n}function L(e,t,s,i,n,a=!1){let r="";if(i&&i.hasOwnProperty(s)&&(r=i[s]),"series"==e&&i.links&&i.links.length>0){r="<span style='vertical-align: middle'>"+r+"</span>",r+="<div class='dropdown'><input type='button' class = 'lnkSelector ddKeep'><div id='"+("row"+t+"_ddLnk")+"' class='ddcontent lnkList-content'></div></div>"}else"season"!=e&&"epWatched"!=e||(r=!0===a?"<div class='counterContainer'> <div class='counterValue'>"+r+"</div></div>":"<div class='counterContainer'> <input type='button' class = 'downBtn'><div class='counterValue'>"+r+"</div><input type='button' class = 'upBtn'></div>");return this.getTextFieldLineTag(e,t,n,r)}function f(e,t,s,i="text"){let n=N(e,t,i);return this.getTextFieldLineTag(e,t,s,n)}function N(e,t,s="text",i=""){let n="";return"number"===s&&(n=" min='0'"),"<input type='"+s+"' id='"+e+"_text"+t+"'"+n+" class='TableInput' value='"+i+"'>"}function _(e,t,s,i=""){return s&&(s="class='"+s+"'"),"<td id='"+e+"_row"+t+"' "+s+">"+i+"</td>"}function T(e,t=e){return"<a href="+e+" target='_blank'>"+t+"</a>"}function w(e){let t="syncWarning";if(!document.getElementById(t)&&e){let e=document.getElementsByClassName("tableWrapper")[0],s=document.createElement("label");s.id=t,s.className="warningMessage",s.innerHTML="This is a list restored from a local backup. An attempt to save the list to the cloud settings will be made after any change!",e.insertAdjacentElement("afterbegin",s)}else if(!e){let e=document.getElementById(t);e&&e.remove()}}class C{constructor(e,t=[],s=""){this._listName=e,this._dataArray=t,this._pageLink=s}get listName(){return this._listName}get pageLink(){return this._pageLink}get dataArray(){return this._dataArray}set dataArray(e){this._dataArray=e}buttonClick(e,t){-1!==e.id.indexOf("_btnNew")?this.addLine():-1!==e.id.indexOf("_delBtn")&&this.delLine(t[1])}enterKeyDown(e,t){-1!==e.id.indexOf("_inpNew")&&this.addLine()}exportDataList(){let e=document.getElementById(this.listName+"_ul").getElementsByTagName("LI");this.dataArray=[];for(var t=0;t<e.length-2;t++){let e=document.getElementById(this.listName+"_inp"+t).value;this.dataArray.push(e)}return this.dataArray}clearList(){this.dataArray=[],this.updateListBody()}delLine(e,t=!0){this.dataArray.splice(e,1),!0===t&&this.updateListBody()}addLine(e=!0){let t=document.getElementById(this.listName+"_inpNew");t.value||(t.value=this.pageLink),this.dataArray.push(t.value),e&&(t.value="",this.addLastLineDom())}addLastLineDom(){let e=this.dataArray.length-1,t=document.createElement("li");t.id=this.listName+"_li"+e,t.className="item",t.innerHTML=this.getLiContentLine(e);let s=document.getElementById(this.listName+"_ul"),i=s.getElementsByTagName("LI").length;s.insertBefore(t,s.childNodes[i-1])}updateListBody(){document.getElementById(this.listName+"_ul").outerHTML=this.getListBody()}getListBody(){let e=this.listName+"_ul",t="";return t+="<ul id='"+e+"' class='editable-list'>",t+="<li class='listHeader'><h3>Links:</h3></li>",this.dataArray.forEach((e,s)=>{let i=this.listName+"_li"+s;t+="<li id='"+i+"' class='item'>"+this.getLiContentLine(s)+"</li>"}),t+="<li class='item'>"+this.getLiContentLine()+"</li>",t+="</ul>",t}getLiContentLine(e=-1){let t="";if(e<0||e>this.dataArray.length){t="<input id='"+(this.listName+"_inpNew")+"' class = 'ListInput' type='text' placeholder='"+'Enter new link and press "Enter" or "+" button to add'+"' value=''><span id='"+(this.listName+"_btnNew")+"' class='settingsListButton'>+</span>"}else{let s=this.listName+"_inp"+e,i=this.listName+"_delBtn"+e;t="<input id='"+s+"' class = 'ListInput' type='text' value='"+this.dataArray[e]+"'><span id='"+i+"' class='settingsListButton'>&times;</span>"}return t}}var j=s(2);class B{constructor(e,t,s=[]){this._listName=e,this._headerText=t,this._dataArray=s}get listName(){return this._listName}get headerText(){return this._headerText}get dataArray(){return this._dataArray}set dataArray(e){this._dataArray=e}dropClick(e,t){e.classList.contains("show")?e.classList.remove("show"):e.classList.add("show")}exportDataList(){let e=document.getElementById(this.listName+"_ul").getElementsByTagName("LI");this.dataArray=[];for(var t=0;t<e.length-2;t++){let e=document.getElementById(this.listName+"_inp"+t).value;this.dataArray.push(e)}return this.dataArray}clearList(){this.dataArray=[],this.updateListBody()}delLine(e,t=!0){this.dataArray.splice(e,1),!0===t&&this.updateListBody()}addLine(e=!0){let t=document.getElementById(this.listName+"_inpNew");this.dataArray.push(t.value),e&&(t.value="",this.addLastLineDom())}addLastLineDom(){let e=this.dataArray.length-1,t=document.createElement("li");t.id=this.listName+"_li"+e,t.className="item",t.innerHTML=this.getLiContentLine(e);let s=document.getElementById(this.listName+"_ul"),i=s.getElementsByTagName("LI").length;s.insertBefore(t,s.childNodes[i-1])}updateListBody(){document.getElementById(this.listName+"_ul").outerHTML=this.getListBody()}getListBody(){let e=this.listName+"_con",t=this.listName+"_div",s="";return s+='<div id="'+e+'" class="dropdown-check-list" tabindex="100">',s+='<span class="anchor ddKeep">'+this.headerText+"</span>",s+='<div id="'+t+'" class="ddcontent ddKeep comboTag-content" tabindex="100">',s+="<ul>",this.dataArray.forEach((e,t)=>{let i=this.listName+"_li"+t;s+='<li id="'+i+'" class="ddKeep">'+this.getLiContentLine(t)+"</li>"}),s+="</ul>",s+="</div>",s+="</div>",s}getLiContentLine(e=-1){let t="";if(e<0||e>this.dataArray.length){t="<input id='"+(this.listName+"_inpNew")+"' class = 'ListInput' type='text' placeholder='"+'Enter new text and press "Enter" or "+" button to add'+"' value=''><span id='"+(this.listName+"_btnNew")+"' class='settingsListButton'>+</span>"}else{let s=this.listName+"_inp"+e,i=this.listName+"_delBtn"+e;t='<input id="'+s+'" class="ddKeep" type="checkbox" />'+this.dataArray[e]+'<span id="'+i+'" class="ddKeep comboListButton">&times;</span>'}return t}}let v=new class{constructor(e,t={},s=[{domName:"",domHeader:"",fieldType:"",objName:""}]){this._tName=e,this._dataObject=t,this._tableStructure=s,this._designModule,this._dataProvider,this._appSettings,this._colorConverter,this._EditableListClass,this._editableListInUse={},this._ComboSelectListClass,this._comboSelectListInUse={},this._activeLink}get tableName(){return this._tName}get dataObject(){return this._dataObject}set dataObject(e){this.fillTableFromObj(e)&&(this._dataObject=e)}get tableStructure(){return this._tableStructure}set tableStructure(e){this._tableStructure=e}get designModule(){return this._designModule}set designModule(e){this._designModule=e}get dataProvider(){return this._dataProvider}set dataProvider(e){this._dataProvider=e}get appSettings(){return this._appSettings}set appSettings(e){this._appSettings=e;this._appSettings.addUpdateListenersFunctions(()=>{this.refreshDom()})}get colorConverter(){return this._colorConverter}set colorConverter(e){this._colorConverter=e}get EditableListClass(){return this._EditableListClass}set EditableListClass(e){this._EditableListClass=e}get editableListInUse(){return this._editableListInUse}set editableListInUse(e){this._editableListInUse=e}get ComboSelectListClass(){return this._ComboSelectListClass}set ComboSelectListClass(e){this._ComboSelectListClass=e}get comboSelectListInUse(){return this._comboSelectListInUse}set comboSelectListInUse(e){this._comboSelectListInUse=e}get activeLink(){return this._activeLink}set activeLink(e){this._activeLink=e}setEventHandlerForSettings(){let e=document.getElementById(this.tableName).getElementsByTagName("tbody")[0];e.addEventListener("click",e=>{switch(!0){case"settingsListButton"===e.target.className:let t=e.target.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.editableListInUse["lnkRow"+t[0]].buttonClick(e.target,t);break;case e.target.classList.contains("lnkSelector"):this.closeAllDropDowns();let s=e.target.parentNode.parentNode.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.showDropDownList(s[0]);break;case"downBtn"===e.target.className||"upBtn"===e.target.className:this.counterChange(e.target.className,e.target.parentNode.parentNode.id);break;case e.target.classList.contains("anchor"):let i=e.target.parentNode.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.comboSelectListInUse["tagSelector_row"+i[0]].dropClick(e.target.nextSibling,i)}},!1),e.addEventListener("keydown",e=>{switch(!0){case 13===e.keyCode&&"ListInput"===e.target.className:let t=e.target.id.match(/^\d+|\d+\b|\d+(?=\w)/g);this.editableListInUse["lnkRow"+t[0]].enterKeyDown(e.target,t)}},!1),window.onclick=e=>{e.target.classList.contains("ddKeep")||this.closeAllDropDowns()}}showDropDownList(e){let t="row"+e+"_ddLnk",s=document.getElementById(t),i="",n=this.dataObject;if(n&&n.Series&&e<n.Series.length){let t=this.designModule.getLinksObjName(),s=this.dataObject.Series[e][t];s&&s.forEach(t=>{let s=t.match(/^https?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i),n=s&&s[1];n||(n=t);let a=this.applyLnkTemplate(t,this.dataObject.Series[e]);i+=this.designModule.lnkStringByData(a,n)})}s.classList.toggle("show"),s.innerHTML=i}closeAllDropDowns(){let e=document.getElementsByClassName("ddcontent");for(let t=0;t<e.length;t++){let s=e[t];s.classList.contains("lnkSelector")&&(e[t].innerHTML=""),s.classList.contains("show")&&s.classList.remove("show")}}counterChange(e,t){let s=t.match(/^\d+|\d+\b|\d+(?=\w)/g),i=String(t.match(/[^_]*/)).toString(),n=this.getJsonAttrName(i),a=0;"upBtn"===e?a=1:"downBtn"===e&&(a=-1);let r=this.dataObject.Series[s];if(r[n]+=a,n===this.designModule.getSeasonObjName()&&a>0){r[this.designModule.getEpisodeObjName()]=0}this.updateLineCounterChangeDate(s),this.callObjListSave(this.dataObject),document.getElementById("row"+s).innerHTML=this.designModule.getListLineTags(s,this,r,this.appSettings.isCurrentStorageClosed()),this.setColorByLineDateChange(s,r),this.setRowStyleByActiveTabLink(s,r)}updateLineCounterChangeDate(e){let t=this.dataObject.Series[e],s=new Date;t.lastCounterChangeTime=s.getTime()}getJsonAttrName(e){return this._tableStructure.filter(t=>t.domName===e)[0].objName}getClassName(e){return this._tableStructure.filter(t=>t.domName===e)[0].domClassaName}getfieldType(e){return this._tableStructure.filter(t=>t.domName===e)[0].fieldType}getObjectLineAttributesAsObject(){return this._tableStructure.reduce((e,t)=>(t.objName&&Object.assign(e,{[t.objName]:""}),e),{})}getObjectLineAttributes(){return Object.keys(this.getObjectLineAttributesAsObject())}refreshDom(){this.fillTableFromObj(this.dataObject)}fillTableFromObj(e){this.designModule.ShowSyncSaveCrashWarning(this.appSettings.getSyncCrash());let t=!1;return e&&e.hasOwnProperty("Series")&&(this.clearTableRows(),e.Series.forEach(e=>{this.addRow(e)}),t=!0),this.addEditRowIfEmpty(),t}addEditRowIfEmpty(){document.getElementById(this._tName).getElementsByTagName("tbody")[0].rows.length<1&&this.addRow()}importList(e){try{let t=JSON.parse(e);this.dataObject=t,this.callObjListSave(this.dataObject)}catch(e){console.error(e.name+": "+e.message),alert("Wrong file format. Please select correct json file.")}}updateHeader(){document.getElementById(this._tName).getElementsByTagName("thead")[0].innerHTML=this.designModule.getTableHeadTags(this.tableStructure)}clearTableRows(){this.updateHeader(),document.getElementById(this._tName).getElementsByTagName("tbody")[0].innerHTML="",this.editableListInUse={}}addRow(e=null){let t=document.getElementById(this._tName).getElementsByTagName("tbody")[0],s=document.getElementsByClassName(this.designModule.getSettingsStringClassName()),i=t.rows.length,n=i-s.length,a=this.dataObject;if(!e&&a.Series&&n-a.Series.length>0)return;let r="<tr id='row"+n+"'>";r+=this.designModule.getListLineTags(n,this,e,this.appSettings.isCurrentStorageClosed()),r+="</tr>",t.insertRow(i).outerHTML=r,e||this.addSettingsRow(n),this.setColorByLineDateChange(n,e),this.setRowStyleByActiveTabLink(n,e)}edit_row(e){this._tableStructure.filter(e=>e.domName).forEach((t,s,i)=>{let n="",a=this.dataObject;if(a&&a.Series&&e<a.Series.length){let s=this.getJsonAttrName(t.domName);n=this.dataObject.Series[e][s]}let r=document.getElementById(t.domName+"_row"+e),o=this.getfieldType(t.domName);r.innerHTML=this.designModule.getInputFieldLineTag(t.domName,e,o,n)}),this.addSettingsRow(e),this.designModule.switchButtonsToEdit(e)}save_row(e){let t=this.dataObject,s=t.Series;if(e-s.length>0)return void alert("Please save the lines in order it added!");e>=s.length&&s.push(this.getObjectLineAttributesAsObject());let i=s[e];this.tableStructure.forEach((t,s,n)=>{let a=this.getfieldType(t.domName);if("lnk"==a){let s=this.editableListInUse["lnkRow"+e];i[this.getJsonAttrName(t.domName)]=s.exportDataList()}else if(this.getJsonAttrName(t.domName)){let s=document.getElementById(t.domName+"_text"+e).value;"number"==a&&(s=parseInt(s),s||(s=0)),i[this.getJsonAttrName(t.domName)]=s}}),this.delSettingsRow(e),document.getElementById("row"+e).innerHTML=this.designModule.getListLineTags(e,this,i,this.appSettings.isCurrentStorageClosed()),this.callObjListSave(t),this.setColorByLineDateChange(e,i),this.setRowStyleByActiveTabLink(e,i)}delete_row(e){let t=this.dataObject;t.Series.length>0&&(t.Series.splice(e,1),this.callObjListSave(t)),this.fillTableFromObj(t)}callObjListSave(e){this.dataProvider.saveObjectList(e,this.appSettings),this.designModule.ShowSyncSaveCrashWarning(this.appSettings.getSyncCrash())}addSettingsRow(e){let t=document.getElementById("row"+e),s=this.getSettingsLineBody(e),i=this.designModule.getSettingsLineElement(e,s);t.parentNode.insertBefore(i,t.nextSibling)}delSettingsRow(e){document.getElementById("options_temp_row"+e).outerHTML="",delete this.editableListInUse["lnkRow"+e]}getActiveLink(){chrome.tabs.query({active:!0,lastFocusedWindow:!0},e=>{let t=e[0].url;this.activeLink=t.split(/[?#]/)[0],this.checkLinesByLnk()})}getSettingsLineBody(e){return this.addTagSelectorObject(e)+this.addLnkSettingsObject(e)}addTagSelectorObject(e){let t=new this.ComboSelectListClass("tagSelector_row"+e,"Test tag selector",["Test Tag 1","Test Tag 2","Test Tag 3","Test Tag 4","Test Tag 5","Test Tag 6","Test Tag 7"]);return this.comboSelectListInUse["tagSelector_row"+e]=t,t.getListBody()}addLnkSettingsObject(e){let t=[],s=this.dataObject;if(s&&s.Series&&e<s.Series.length){let s=this.designModule.getLinksObjName();t=this.dataObject.Series[e][s]}let i=new this.EditableListClass("lnkSettings_row"+e,t,this.activeLink);return this.editableListInUse["lnkRow"+e]=i,i.getListBody()}setColorByLineDateChange(e,t){if(t&&t.hasOwnProperty("lastCounterChangeTime")){let s=new Date,i=864e5,n=Math.trunc((s.getTime()-t.lastCounterChangeTime)/i),a=this.appSettings.getAgeingPeriod();if(n>=0&&n<a){let t=this.appSettings.getAgeingColorScheme();document.getElementById("row"+e).style.backgroundColor=this.colorConverter.getColorByHSLRange(t,n,0,a)}}}checkLinesByLnk(){let e=this.dataObject;e&&e.Series&&e.Series.forEach((e,t)=>{this.setRowStyleByActiveTabLink(t,e)})}setRowStyleByActiveTabLink(e,t){if(this.isActiveTabInLinks(t)){let t=this._tableStructure[0].domName+"_row"+e;try{let e=document.getElementById(t);e.style["font-weight"]="bold",e.style["font-size"]="110%",this.appSettings.getScrollToActive()&&e.scrollIntoViewIfNeeded(!0)}catch{}}}isActiveTabInLinks(e){let t=!1,s=this.designModule.getLinksObjName();if(e&&e.hasOwnProperty(s)&&e[s].length>0){e[s].find(t=>this.applyLnkTemplate(t.split(/[?#]/)[0],e)===this.activeLink)&&(t=!0)}return t}applyLnkTemplate(e,t){let s=this.designModule.getSeasonObjName(),i=this.designModule.getEpisodeObjName(),n=this.designModule.getSeasonTemplate(),a=this.designModule.getEpisodeTemplate(),r=0,o=0;t[s]&&(r=t[s]),t[i]&&(o=t[i]);let l=e.replace(n,r.toString());return l=l.replace(a,o.toString()),l}}("slist_table",a.getEmptyObjList()),O=new j.a;O.dataProvider=a,a.loadAppSettings(O),v.appSettings=O,v.designModule=i,v.dataProvider=a,v.colorConverter=n,v.EditableListClass=C,v.tableStructure=[{domName:"series",domHeader:"Series",domClassaName:"tSeriesName",fieldType:"text",objName:"name"},{domName:"",domHeader:"",domClassaName:"",fieldType:"lnk",objName:"links"},{domName:"season",domHeader:"Season",domClassaName:"tSeasons",fieldType:"number",objName:"season"},{domName:"epWatched",domHeader:"Watched",domClassaName:"tEpisodes",fieldType:"number",objName:"episode"},{domName:"",domHeader:"",domClassaName:"",fieldType:"text",objName:""},{domName:"",domHeader:"",domClassaName:"",fieldType:"date",objName:"lastCounterChangeTime"}],v.ComboSelectListClass=B,v.fillTableFromObj(a.getEmptyObjList()),a.loadObjectListFromStorage(v,v.appSettings),v.setEventHandlerForSettings(),v.getActiveLink(),document.getElementById("settings-btn").addEventListener("click",()=>{a.appSettingsOpen()},!1),document.getElementById("imp-btn").addEventListener("click",()=>{v.addRow()},!1),document.getElementById("dwn-btn").addEventListener("click",()=>{a.exportObject(v.dataObject,"SerialList.json")},!1),document.getElementById("fileSelect-btn").addEventListener("click",()=>{a.fileSelectButtonClick(v)},!1),document.getElementById(v.tableName).getElementsByTagName("tbody")[0].addEventListener("click",e=>{switch(!0){case e.target.id.startsWith("edit_button"):v.edit_row(e.target.id.match(/\d/g).join(""));break;case e.target.id.startsWith("save_button"):v.save_row(e.target.id.match(/\d/g).join(""));break;case e.target.id.startsWith("del_button"):v.delete_row(e.target.id.match(/\d/g).join(""))}},!1)}]);